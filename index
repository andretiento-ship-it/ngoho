<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuntilanak Vlog Storyboard Gen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .horror-font { font-family: 'Creepster', cursive; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #7f1d1d; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #991b1b; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8 border-b border-red-900/50 pb-6">
            <h1 class="text-4xl md:text-6xl horror-font text-red-600 mb-2 tracking-wider drop-shadow-lg">Kunti Story Engine</h1>
            <p class="text-gray-400">Veo 3 Storyboard Prompt Generator (Combined Dialog)</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Panel: Inputs (4 Columns) -->
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg sticky top-6">
                    <h2 class="text-xl font-bold mb-4 text-red-500 border-b border-gray-700 pb-2 flex items-center gap-2">
                        <span>üìù</span> Input Data
                    </h2>
                    
                    <!-- Visual Karakter Input -->
                    <div class="mb-4">
                        <label class="block text-xs font-uppercase tracking-wider text-gray-400 mb-1">1. Visual Karakter (Detail)</label>
                        <textarea id="characterVisual" rows="5" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-red-500 focus:outline-none placeholder-gray-600 text-gray-300">A scary Kuntilanak vlogger, gaunt face, hollow dark eyes, prominent cheekbones, pale skin, messy long black hair, mortis claws hands, wearing a dirty white tattered daster and a simple golden crown. Holding a rusty iron rod selfie stick.</textarea>
                        <p class="text-xs text-gray-600 mt-1">Definisi visual ini akan dipakai konsisten di semua scene.</p>
                    </div>

                    <!-- Ide Cerita Input -->
                    <div class="mb-6">
                        <label class="block text-xs font-uppercase tracking-wider text-gray-400 mb-1">2. Ide Cerita / Premis</label>
                        <textarea id="storyIdea" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-red-500 focus:outline-none placeholder-gray-500" placeholder="Contoh: Kuntilanak mau mukbang seblak level 100 tapi malah keselek dan viral..."></textarea>
                    </div>

                    <!-- Generate Story Button -->
                    <button onclick="generateStory()" id="btnGenerateStory" class="w-full bg-gradient-to-r from-red-800 to-red-600 hover:from-red-700 hover:to-red-500 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-lg transform active:scale-95 flex items-center justify-center gap-2 border border-red-500">
                        <span id="btnText">üíÄ Generate Storyboard</span>
                    </button>
                    
                    <div id="errorMsg" class="hidden mt-4 p-3 bg-red-900/50 border border-red-500 rounded text-xs text-red-200"></div>
                </div>
            </div>

            <!-- Right Panel: Storyboard Output (8 Columns) -->
            <div class="lg:col-span-8">
                <div id="initialState" class="flex flex-col items-center justify-center h-64 text-gray-600 border-2 border-dashed border-gray-800 rounded-xl">
                    <span class="text-4xl mb-2">üé¨</span>
                    <p>Masukkan visual & ide cerita, lalu klik Generate.</p>
                </div>

                <!-- Storyboard Container -->
                <div id="storyboardContainer" class="hidden space-y-6">
                    <!-- Scenes will be injected here via JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Template for Scene Card (Hidden) -->
    <template id="sceneTemplate">
        <div class="scene-card bg-gray-800 rounded-xl border border-gray-700 overflow-hidden shadow-xl transition hover:border-gray-500">
            <!-- Scene Header -->
            <div class="bg-gray-900/50 p-3 border-b border-gray-700 flex justify-between items-center">
                <span class="scene-title font-bold text-red-400 font-mono tracking-wider">SCENE 1: INTRO</span>
                <span class="scene-camera text-xs bg-gray-700 px-2 py-1 rounded text-gray-300">Selfie Angle</span>
            </div>
            
            <div class="p-4">
                <!-- Text Content -->
                <div class="space-y-4">
                    <!-- Combined Prompt Section -->
                    <div>
                        <label class="text-xs text-green-400 font-bold tracking-wider">PROMPT & DIALOG (READY TO COPY):</label>
                        <div class="relative group">
                            <p class="scene-prompt text-sm text-gray-300 font-mono bg-black p-4 rounded border border-green-900/40 mt-1 whitespace-pre-wrap leading-relaxed shadow-inner">...</p>
                            <button class="btn-copy absolute top-2 right-2 text-[10px] bg-gray-800 hover:bg-gray-700 text-white px-3 py-1.5 rounded border border-gray-600 transition-colors shadow-lg">Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        // API Configuration
        const apiKey = ""; // Injected by environment

        async function generateStory() {
            const charVisual = document.getElementById('characterVisual').value;
            const storyIdea = document.getElementById('storyIdea').value;
            const btn = document.getElementById('btnGenerateStory');
            const btnText = document.getElementById('btnText');
            const container = document.getElementById('storyboardContainer');
            const initialState = document.getElementById('initialState');
            const errorMsg = document.getElementById('errorMsg');

            if (!storyIdea) {
                alert("Mohon isi ide cerita!");
                return;
            }

            // UI Loading State
            btn.disabled = true;
            btnText.textContent = "Sedang Merangkai Cerita...";
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            errorMsg.classList.add('hidden');
            
            try {
                const systemPrompt = `
                You are a creative horror-comedy director and scriptwriter. 
                Your task is to take a Character Visual description and a Story Idea, and create a 6-scene storyboard for a short vertical video (Shorts/Reels).
                
                The structure MUST be:
                1. Intro (Hook)
                2. Problem (Conflict starts)
                3. Chaos (Climax/Funny/Scary moment)
                4. Quote (Wise words but horror context)
                5. Outro (Conclusion)
                6. CTA (Call to Action - "Klik link di bio cuma 10rb")

                Output strictly in JSON format with this array structure:
                [
                    {
                        "title": "SCENE 1: INTRO",
                        "camera": "Selfie Vlog Angle (Fish-eye)",
                        "prompt": "Detailed VIDEO PROMPT for Veo 3. Structure: [Visual/Motion Description in English] + [Camera Movement]. Then immediately add the character's dialogue in Indonesian. Format: She says: \"[Indonesian Dialog]\".\nConstraint: The Indonesian dialogue MUST be maximum 21 words per scene."
                    },
                    ... (repeat for all 6 scenes)
                ]
                
                IMPORTANT:
                - Do NOT separate script and prompt. Combine them into the 'prompt' field.
                - Start the prompt with the Character Visual: '${charVisual}'.
                - The prompt must focus on MOTION (e.g., 'talking to camera', 'panicked expression', 'shaking camera').
                - Dialogue must be short, punchy, and funny/scary (Max 21 words).
                - Ensure the CTA scene includes the prop: "Holding a small whiteboard text: 'bikin video kaya gini cuma 10rb'".
                `;

                const userPrompt = `Character: ${charVisual}\nStory Idea: ${storyIdea}`;

                // Call Gemini for Text Generation
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                if (!response.ok) throw new Error("Gagal menghubungi AI Director.");

                const data = await response.json();
                
                // Safe JSON Parsing
                let rawText = data.candidates[0].content.parts[0].text;
                rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                
                const storyData = JSON.parse(rawText);

                // Render Storyboard
                renderStoryboard(storyData);
                
                initialState.classList.add('hidden');
                container.classList.remove('hidden');

            } catch (error) {
                console.error(error);
                errorMsg.textContent = "Error: " + error.message;
                errorMsg.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btnText.textContent = "üíÄ Generate Storyboard";
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function renderStoryboard(scenes) {
            const container = document.getElementById('storyboardContainer');
            const template = document.getElementById('sceneTemplate');
            
            container.innerHTML = ''; // Clear previous

            scenes.forEach((scene, index) => {
                const clone = template.content.cloneNode(true);
                
                // Set Data
                clone.querySelector('.scene-title').textContent = scene.title;
                clone.querySelector('.scene-camera').textContent = scene.camera;
                // Script section removed, prompt now contains everything
                clone.querySelector('.scene-prompt').textContent = scene.prompt;
                
                // Copy Button Logic with Fallback for iFrames
                const copyBtn = clone.querySelector('.btn-copy');
                copyBtn.onclick = () => {
                    // Create a hidden textarea to use document.execCommand
                    const textArea = document.createElement("textarea");
                    textArea.value = scene.prompt;
                    textArea.style.position = "fixed"; 
                    textArea.style.left = "-9999px";
                    textArea.style.top = "0";
                    document.body.appendChild(textArea);
                    
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            copyBtn.textContent = "Copied!";
                            copyBtn.classList.add('bg-green-700');
                        } else {
                            copyBtn.textContent = "Error";
                        }
                    } catch (err) {
                        console.error('Fallback: Oops, unable to copy', err);
                        copyBtn.textContent = "Error";
                    }
                    
                    document.body.removeChild(textArea);
                    setTimeout(() => {
                        copyBtn.textContent = "Copy";
                        copyBtn.classList.remove('bg-green-700');
                    }, 1500);
                };

                container.appendChild(clone);
            });
        }
    </script>
</body>
</html>
